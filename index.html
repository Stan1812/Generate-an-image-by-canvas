<!DOCTYPE html>
<html>
<head>
	<title>canvas练习</title>
	<meta charset="utf-8">
</head >
<style type="text/css">
	body{
		display: flex;
		flex-direction: column;		
	}
	.con{
		margin: 0 auto;
		border:2px  solid #666;
		display: inline-flex;
	}
	span{
		text-align: center;
		width: 100px;
		height: 50px;
		border:2px solid black;
		margin: 0 auto;
		margin-top: 50px;
		line-height: 50px;
	}
</style>


<body>
	<div class="con"><canvas id="canvas" height="500px" width="1000px"></canvas>
	<canvas id="canvas2" height="50px" width="100px"></canvas></div>
	<span id="download">点击下载</span>

<script type="text/javascript">
var canvas=document.getElementById('canvas');
var ctx=canvas.getContext('2d');
//test
var canvas2=document.getElementById('canvas2');
var ctx2=canvas2.getContext('2d');
ctx2.beginPath();
			ctx2.fillRect(0,0,50,50);			
			ctx2.closePath();

//下载按钮			
var btn=document.getElementById('download');





//将生成的文字图片生成像素数据，然后写入到大图上
var imgdata=ctx2.getImageData(0,0,50,500);
console.log(imgdata);
ctx.putImageData(imgdata,0,0);



//上传图片模块


//下载模块
btn.addEventListener('click',function(){
	var type='jpg';
	download(type)
})
//图片下载操作,指定图片类型
function download(type) {

    //设置保存图片的类型
    var imgdata = canvas.toDataURL(type);
    
    //将mime-type改为image/octet-stream,强制让浏览器下载
    var fixtype = function (type) {
        type = type.toLocaleLowerCase().replace(/jpg/i, 'jpeg');
        var r = type.match(/png|jpeg|bmp|gif/)[0];
        return 'image/' + r;
    }
    imgdata = imgdata.replace(fixtype(type), 'image/octet-stream')
    
    //将图片保存到本地
    var saveFile = function (data, filename) {
        var link = document.createElement('a');
        link.href = data;
        link.download = filename;
        var event = document.createEvent('MouseEvents');
        event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        link.dispatchEvent(event);
    }
    var filename = new Date().toLocaleDateString() + '.' + type;
    saveFile(imgdata, filename);
}
	</script>
</body>
</html>